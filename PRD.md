# API Mock Platform 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 项目背景
前后端分离开发模式下，前端开发依赖后端接口，导致开发效率低下。需要一个自主可控的API Mock平台，支持定制化业务场景。

### 1.2 产品目标
- 解决前后端并行开发问题，提升研发效率
- 提供灵活的Mock数据生成和管理能力
- 支持多项目、多环境的接口管理
- 实现接口文档与Mock服务的一体化

### 1.3 目标用户
- 前端开发工程师
- 后端开发工程师
- 测试工程师
- 项目管理人员

## 2. 核心功能

### 2.1 项目管理
- **项目创建**：支持多项目隔离管理
- **成员管理**：项目成员邀请、权限分配
- **环境管理**：开发/测试/预发布环境配置
- **项目设置**：基础信息、访问控制等

### 2.2 接口管理
- **接口定义**：RESTful API规范，支持GET/POST/PUT/DELETE等方法
- **接口分组**：按模块/功能进行接口分组
- **参数配置**：请求参数、响应参数、数据类型定义
- **接口文档**：自动生成接口文档，支持在线调试
- **版本控制**：接口版本管理，变更历史记录

### 2.3 Mock引擎
- **智能Mock**：基于参数类型自动生成Mock数据
- **自定义规则**：支持JavaScript表达式、Faker.js等规则
- **动态数据**：支持时间戳、随机数、递增序列等
- **数据关联**：支持接口间数据关联和依赖
- **条件返回**：根据请求参数返回不同响应

### 2.4 代理服务
- **请求拦截**：拦截前端API请求
- **智能路由**：根据配置路由到Mock服务或真实接口
- **请求日志**：记录所有API请求和响应
- **延迟模拟**：模拟网络延迟和超时场景

### 2.5 数据管理
- **Mock数据库**：存储自定义Mock数据
- **数据导入**：支持JSON/CSV/Excel格式导入
- **数据导出**：支持多种格式导出
- **数据备份**：定期备份Mock配置和数据

### 2.6 监控统计
- **访问统计**：接口调用次数、频率统计
- **性能监控**：响应时间、错误率监控
- **使用报告**：项目使用情况周报/月报
- **日志管理**：操作日志、错误日志查看

## 3. 技术架构

### 3.1 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (Vue)    │────│  Nginx 反向代理  │────│  后端 (Python)  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                       │
                       ┌─────────────────┐    ┌─────────────────┐
                       │  Redis (缓存)   │    │  MySQL (存储)   │
                       └─────────────────┘    └─────────────────┘
```

### 3.2 技术选型
- **后端框架**：FastAPI + SQLAlchemy + Pydantic
- **前端框架**：Vue 3 + Vite + Element Plus
- **数据库**：MySQL 8.0 + Redis 6.0
- **部署方案**：Docker + Docker Compose + Nginx
- **其他工具**：Celery (异步任务)、Faker (数据生成)

### 3.3 系统模块
```
API Mock Platform
├── 用户认证模块 (auth)
├── 项目管理模块 (project)
├── 接口管理模块 (api)
├── Mock引擎模块 (mock)
├── 代理服务模块 (proxy)
├── 数据管理模块 (data)
└── 监控统计模块 (monitor)
```

## 4. 功能详细设计

### 4.1 用户认证
- **注册登录**：邮箱/手机号注册，支持第三方登录
- **权限管理**：超级管理员、项目管理员、开发者、观察者
- **Token认证**：JWT Token，支持刷新机制

### 4.2 接口定义规范
```json
{
  "id": "api_001",
  "name": "获取用户信息",
  "method": "GET",
  "path": "/api/user/{id}",
  "headers": {
    "Authorization": "Bearer {token}"
  },
  "params": {
    "id": {
      "type": "integer",
      "required": true,
      "description": "用户ID"
    }
  },
  "response": {
    "code": 200,
    "data": {
      "id": "@integer(1, 1000)",
      "name": "@name",
      "email": "@email",
      "created_at": "@datetime"
    }
  }
}
```

### 4.3 Mock规则引擎
- **基础类型**：string, integer, float, boolean, array, object
- **Mock规则**：@name, @email, @datetime, @integer(min, max)
- **自定义函数**：支持JavaScript表达式
- **条件逻辑**：if/else条件判断

### 4.4 代理配置
```yaml
proxy:
  rules:
    - path: "/api/user/*"
      target: "mock"  # mock | real | auto
    - path: "/api/order/*"
      target: "http://real-api.com"
  settings:
    delay: 200  # 延迟毫秒
    timeout: 5000  # 超时毫秒
```

## 5. 非功能性需求

### 5.1 性能要求
- **响应时间**：API响应时间 < 200ms
- **并发量**：支持1000+并发请求
- **可用性**：99.9%服务可用性

### 5.2 安全要求
- **数据加密**：敏感数据加密存储
- **访问控制**：接口级权限控制
- **日志审计**：完整的操作日志记录

### 5.3 可扩展性
- **水平扩展**：支持多实例部署
- **插件机制**：支持自定义Mock插件
- **API开放**：提供完整的REST API

## 6. 开发计划

### 6.1 第一期 (MVP版本)
- [x] 项目初始化和技术架构搭建
- [ ] 用户认证模块开发
- [ ] 项目管理基础功能
- [ ] 接口定义和管理
- [ ] 基础Mock功能
- [ ] 前端界面开发

### 6.2 第二期
- [ ] 高级Mock规则引擎
- [ ] 代理服务功能
- [ ] 数据导入导出
- [ ] 监控统计功能
- [ ] 性能优化

### 6.3 第三期
- [ ] 插件系统
- [ ] 团队协作功能
- [ ] API文档生成
- [ ] 自动化测试集成

## 7. 风险评估

### 7.1 技术风险
- **性能瓶颈**：大量并发请求处理
- **数据一致性**：分布式环境下数据同步
- **安全漏洞**：API安全防护

### 7.2 业务风险
- **用户接受度**：学习成本和使用习惯
- **竞品冲击**：开源方案的竞争
- **需求变更**：定制化需求的频繁变更

### 7.3 缓解措施
- 分阶段迭代开发，快速验证核心功能
- 完善的测试覆盖和代码审查
- 持续的用户反馈收集和产品优化

---

**文档版本**：v1.0  
**创建时间**：2025-09-19  
**最后更新**：2025-09-19  
**负责人**：开发团队